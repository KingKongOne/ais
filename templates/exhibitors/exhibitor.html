{% extends "base.html" %}

{% load crispy_forms_tags %}
{% load humanize %}

{% block nav-exhibitors %}<li role="presentation" class="active"><a href="{% url 'exhibitors' fair.year %}">Exhibitors</a></li>{% endblock %}

{% block content %}
	<ol class="breadcrumb">
		<li><a href="{% url 'exhibitors' fair.year %}">Exhibitors</a></li>
		<li class="active">{{ exhibitor.company }}</li>
	</ol>
	
	<h1>{{ exhibitor.company }}</h1>
	
	<p>
		{% if perms.exhibitors.transport %}<a href="{% url 'exhibitor_transport' fair.year exhibitor.pk %}" type="button" class="btn btn-default"><span class="glyphicon glyphicon-th"></span> Transport</a>{% endif %}
	</p>
	
	<div class="row">
		<div class="col-md-4">
			{% for contact in contacts %}
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2 class="panel-title">{{ contact }}</h2>
						{% if contact.title %}{{ contact.title }}{% endif %}
					</div>
					
					<div class="panel-body">
						<ul class="list-unstyled">
							{% if contact.user %}
								<li><strong>Username:</strong> {{ contact.user.username }}</li>
								<li><strong>Registered:</strong> {{ contact.user.date_joined }}</li>
								<li><strong>Last login:</strong> {{ contact.user.last_login }}</li>
							{% endif %}
							
							<li><strong>E-mail address:</strong> <a href="mailto:{{ contact.email_address }}">{{ contact.email_address }}</a></li>
							{% if contact.mobile_phone_number %}<li><strong>Mobile phone number:</strong> <a href="tel:{{ contact.mobile_phone_number }}">{{ contact.mobile_phone_number }}</a></li>{% endif %}
							{% if contact.work_phone_number %}<li><strong>Work phone number:</strong> <a href="tel:{{ contact.work_phone_number }}">{{ contact.work_phone_number }}</a></li>{% endif %}
						</ul>
					</div>
				</div>
			{% endfor %}
		</div>
		
		<div class="col-md-8">
			<div class="row">
				<div class="col-md-5">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Responsibilities</h3>
						</div>
						
						<div class="panel-body">
							{% if responsibles %}
								<ul class="list-unstyled">
									{% for responsible in responsibles %}
										<li>
											{{ responsible.group }} â€“
											{% for user in responsible.users.all %}
												<a href="{% url 'view_person' fair.year user.profile.pk %}">{{ user }}</a>
											{% endfor %}
										</li>
									{% endfor %}
								</ul>
							{% else %}
								<p>No responsibilities specified.</p>
							{% endif %}
						</div>
					</div>
				</div>
				
				<div class="col-md-7">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Contact persons</h3>
						</div>
						
						<div class="panel-body">
							{% if contact_persons %}
								<ul class="list-unstyled">
									{% for contact_person in contact_persons %}
										<li>
											<a href="{% url 'view_person' fair.year contact_person.user.profile.pk %}">{{ contact_person.user }}</a>
											{% if contact_person.role %} ({{ contact_person.role }}){% endif %}
										</li>
									{% endfor %}
								</ul>
							{% else %}
								<p>No contact persons specified.</p>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
			
			<div class="panel panel-default">
				<div class="panel-heading">
					<h2 class="panel-title">Orders</h2>
				</div>
				
				<div class="panel-body">
					{% if orders %}
						<table class="table">
							<thead>
								<tr>
									<th>Product</th>
									<th style="text-align: right;">Quantity</th>
									<th style="text-align: right;">Unit price</th>
								</tr>
							</thead>
							
							{% for order in orders %}
								<tr>
									<td>
										{{ order.name }}
										
										{% if order.comment %}
											<br /><span style="font-style: italic;">{{ order.comment }}</span>
										{% endif %}
									</td>
									<td style="text-align: right;">{{ order.quantity }}</td>
									<td style="text-align: right;">{{ order.unit_price | intcomma }}</td>
								</tr>
							{% endfor %}
						</table>
					{% else %}
						<p>The company has no orders for {{ fair }}.</p>
					{% endif %}
				</div>
			</div>
			
			<div class="panel panel-default">
				<div class="panel-heading">
					<h2 class="panel-title">Write comment</h2>
				</div>
				
				<div class="panel-body">
					<form method="post" enctype="multipart/form-data">
						{% csrf_token %}
						{{ form_comment | crispy }}
						<button class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span> Save comment</button>
					</form>
				</div>
			</div>
			
			{% for comment in comments %}
				<div class="panel panel-info">
					<div class="panel-heading">
						<div class="pull-right">
							<a onclick="confirm('Do you want to remove the comment?');" href=" url 'companies_comments_remove' fair.year company.pk comment.pk %}"><span class="glyphicon glyphicon-remove"></span></a>
							<a href=" url 'companies_comments_edit' fair.year company.pk comment.pk %}"><span class="glyphicon glyphicon-edit"></span></a>
						</div>
						
						<h2 class="panel-title">{{ comment.user }} at {{ comment.timestamp }}</h2>
						{{ comment.groups.all | join:", " }}
					</div>
					
					<div class="panel-body">
						<p>{{ comment.comment | linebreaks }}</p>
					</div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
