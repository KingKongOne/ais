{% extends "base.html" %}

{% block nav-sales %}<li role="presentation" class="active"><a href="{% url 'sales' fair.year %}">Sales</a></li>{% endblock %}


{% block content %}

<h1>Sales</h1>
<!--{% if perms.sales.add_sale %}-->
<p><a href="new" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span> New sale</a></p>
<p><a href="{% url 'companies:new' %}?next={% url 'sales' fair.year %}" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span> New company</a></p>
<!--{% endif %}--> 

<h3>My sales</h3>
<div class="table-responsive">
    <table class="table table-striped" id="my_sales">
        <thead>
        <tr>
            <th>Company</th>
            <th>Campaign</th>
            <th>Responsible</th>
            <th>Status</th>
            <th>Follow Up</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
        </thead>
        {% for sale in my_sales %}
        <tr>
            {% if sale %}
            <td><a href="{{sale.id}}">{{ sale.company.name }}</a></td>
            {% else %}
                <td>{{ company.name }}</td>
            {% endif %}

            <td>{{ sale.campaign.name }}</td>
            <td>
            {% if sale.responsible %}
            <a href="{% url "view_person" fair.year sale.responsible.id %}">{{ sale.responsible.first_name }} {{ sale.responsible.last_name }}</a>
            {% endif %}
            </td>
            <td>{{ sale.status}}</td>
            <td>Yes</td>

            <!--{% if perms.sales.change_sale %}-->
            <td>
                <a href="{% url 'sale_edit' fair.year sale.id %}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
            </td>
	    <!--{% endif %}
            {% if perms.sales.delete_sale %}-->
            <td>
                <a href="{% url 'sale_delete' fair.year sale.id %}" onclick="return confirm('Are you sure you wan\'t to delete?')"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
            </td>
	    <!--{% endif %}-->
        </tr>
        {% endfor %}
    </table>
</div>


<h3>All sales</h3>

<div class="table-responsive">
    <table class="table table-striped", id="all_sales">
        <thead>
        <tr>
            <th>Company</th>
            <th>Campaign</th>
            <th>Responsible</th>
            <th>Status</th>
            <th>Follow Up</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
       </thead>
        {% for sale in sales %}
        <tr>
            {% if sale %}
            <td><a href="{{sale.id}}">{{ sale.company.name }}</a></td>
            {% else %}
                <td>{{ company.name }}</td>
            {% endif %}

            <td>{{ sale.campaign.name }}</td>
            <td>
            {% if sale.responsible %}
            <a href="{% url "view_person" fair.year sale.responsible.id %}">{{ sale.responsible.first_name }} {{ sale.responsible.last_name }}</a>
            {% endif %}
            </td>
            <td>{{ sale.status}}</td>
            <td>Yes</td>

            <!--{% if perms.sales.change_sale %}-->
            <td>
                <a href="{% url 'sale_edit' fair.year sale.id %}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
            </td>
	    <!--{% endif %}
            {% if perms.sales.delete_sale %}-->
            <td>
                <a href="{% url 'sale_delete' fair.year sale.id %}" onclick="return confirm('Are you sure you wan\'t to delete?')"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
            </td>
	    <!--{% endif %}-->
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}
{% block scripts %}
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <script>
        $(document).ready(function () {
            $('#my_sales').DataTable({
                'paging': false
            }),
            $('#all_sales').DataTable({
                'paging': false
            })
        })
    </script>
{% endblock %}
